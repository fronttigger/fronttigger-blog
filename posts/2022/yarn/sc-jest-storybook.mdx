---
title: styled-components + jest + storybook í™˜ê²½ êµ¬ì„±í•˜ê¸° (feat. ë””ìì¸ ì‹œìŠ¤í…œ) #required
tags:
  - yarn
  - typescript
  - rollup
  - react
  - styled-components
  - jest
  - storybook
  - designsystem
published: true # required
date: '2022. 4. 29' # required
description: 'ë² ë¦¬ë² ë¦¬ ìŠ¤íŠ¸ë¡œë² ë¦¬ì˜ ë‘ë²ˆì§¸ ì´ì•¼ê¸° âœŒï¸' # required
thumbnailImg: '/thumbnail/2022/04/yarn/yarn-berry.png' # required
---

import Image from './src/components/image'

[ì´ì „ ê¸€](https://tigger.dev/2022/yarn/berry-ts-rollup-react)ì—ì„œ yarn berry + typescript + rollup + reactë¥¼ í™œìš©í•˜ì—¬ í™˜ê²½êµ¬ì„±ì„ ì§„í–‰í–ˆì—ˆë‹¤.

ê·¸ ë‹¤ìŒ ê¸€ì´ ì œëª©ê³¼ë„ ê°™ì€ ì¶”ê°€ì ì¸ ëª‡ê°€ì§€ì— ëŒ€í•œ ê¸€ë¡œ ì˜ˆê³ ë¥¼ í–ˆì—ˆëŠ”ë° íë¦„ì— ë§ê²Œ ë°”ë¡œ ë°˜ê°•ì œ(?)ë¡œ ì§„í–‰í•˜ê²Œ ë˜ì—ˆë‹¤.

ì´ì „ ê¸€ì˜ ê²°ë¡ ì€ React ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ì„œ ì™¸ë¶€ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê¹Œì§€ ì§„í–‰í–ˆì—ˆë‹¤.

ê·¸ë˜ì„œ ì´ë²ˆì—” styled-componentsë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ë¥¼ ê¾¸ë¯¸ê³ , jestë¡œ ê·¸ê±¸ í…ŒìŠ¤íŠ¸í•˜ê³ , ìŠ¤í† ë¦¬ë¶ì„ í†µí•´ ë¬¸ì„œí™”ê¹Œì§€ ì§„í–‰í•œ ê²½í—˜ì„ ê³µìœ í•˜ë ¤í•œë‹¤.

### styled-components setup

styled componentsë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € ë””ìì¸ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•  í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ peerDependenciesë¥¼ ì¶”ê°€í•´ì•¼í•œë‹¤.

#### peerDependencies ì¶”ê°€

```
yarn add -P styled-components
```

ì¶”ê°€ê°€ ë˜ì—ˆë‹¤ë©´ ì´ì œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëŒ€ì‘í•˜ê¸° ìœ„í•´ devDependenciesì— ì˜ì¡´ì„±ì„ ì¶”ê°€í•œë‹¤.

#### devDependencies ì¶”ê°€

```
yarn add -D @types/styled-components
```

ì´ë ‡ê²Œ ë˜ë©´ ê°œë°œ ì¤€ë¹„ ìì²´ëŠ” ë‹¤ ë!

ë§Œì•½ ì—¬ê¸°ì„œ ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•œ ë„¤ì´ë°ì„ í†µí•œ ë””ë²„ê¹…ì„ ìš©ì´í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤

#### babel-plugin-styled-components ì˜ì¡´ì„± ì¶”ê°€

```
yarn add -D babel-plugin-styled-components
```

```
// .babelrc

{
  "plugins": ["babel-plugin-styled-components"]
}
```

ì ê·¸ëŸ¬ë©´ ë””ë²„ê¹…ê¹Œì§€ ì¤€ë¹„ê°€ ëë‚¬ë‹¤.

ì´ì œ í•œ ë²ˆ ê°„ë‹¨í•œ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸í•´ë³´ì

```
// src/button/index.tsx

import React, { PropsWithChildren } from 'react'

import styled from 'styled-components'

interface ButtonProps {
  color?: string
}

const ButtonComponent = styled.button<ButtonProps>`
  color: ${({ color }) => color || 'black'};
`

function Button({ color, children }: PropsWithChildren<ButtonProps>) {
  return <ButtonComponent color={color}>{children}</ButtonComponent>
}

export default Button
```

ë²„íŠ¼ ì™„ì„±!

ì´ê±¸ ì´ì œ í”„ë¡œì íŠ¸ì—ì„œ ì‹¤í–‰ì„ ì‹œì¼œë³´ì

```
import { Button } from '@fronttigger/design-system';

function App() {
  return (
    <div className='App'>
      <header className='App-header'>
        <Button color='red'>ë²„íŠ¼</Button>
      </header>
    </div>
  );
}

export default App;
```

@@ ìŠ¤íƒ€ì¼ë“œ ì´ë¯¸ì§€ @@

ì™„ë²½í•˜ê²Œ ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•œë‹¤!

ì´ì œ styled-componentsë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°œë°œí•  ìˆ˜ ìˆë‹¤.

### Testing Setup

ë¦¬ì•¡íŠ¸ì—ì„œë„ ì—¬ëŸ¬ê°€ì§€ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŒ… ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆì§€ë§Œ ê°€ì¥ ëŒ€í‘œì ì¸ [react-testing-library](https://testing-library.com/docs/react-testing-library/intro/)ê°€ ìˆë‹¤.

ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•´ë³´ì

#### ì˜ì¡´ì„± ì„¤ì¹˜

ë¨¼ì € ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” [jest](https://jestjs.io/)ê°€ í•„ìš”í•˜ë‹¤.

```
yarn add -D jest babel-jest ts-jest @types/jest identity-obj-proxy
```

ìœ„ ì˜ì¡´ì„±ì„ ëª¨ë‘ ì„¤ì¹˜í–ˆë‹¤ë©´ react-testing-library ê´€ë ¨ëœ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•˜ì

```
yarn add -D @testing-library/dom @testing-library/jest-dom @testing-library/react @testing-library/react-hooks @testing-library/user-event @types/testing-library__jest-dom
```

ë²Œì¨ ì—„ì²­ë‚œ ì–‘ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í–ˆì§€ë§Œ ì•„ì§ ë©€ì—ˆë‹¤.

ê·¸ ì´ìœ ëŠ” í…ŒìŠ¤íŠ¸ëŠ” ê°œë°œí™˜ê²½ì—ì„œ ì‘ì„±í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë¦¬ì•¡íŠ¸ê°€ ê°œë°œí™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ë  ìˆ˜ ìˆë„ë¡ babelê³¼ reactì— ê´€ë ¨ëœ ì˜ì¡´ì„±ì„ ë˜ ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤. ğŸ˜‡

```
yarn add -D @babel/preset-env @babel/preset-react babel-preset-react-app react@17.0.2 react-dom@17.0.2 react-is
```

ì ì´ì œ ê±°ì˜ ë‹¤ì™”ë‹¤.

#### babel ì„¤ì •

ë°©ê¸ˆ ì„¤ì¹˜í•œ babelì„ ì„¤ì •í•œë‹¤.

```
{
  "presets": [
    "@babel/preset-env",
    "@babel/preset-react",
    ["react-app", { "flow": false, "typescript": true }]
  ],
  "plugins": ["babel-plugin-styled-components"]
}
```

#### jest ì„¤ì •

ì ì´ì œ í…ŒìŠ¤íŠ¸ì˜ ëŒ€ë§ì˜ ë§ˆì§€ë§‰ ì„¤ì • ë‹¨ê³„ë‹¤.

jestë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‘ê°€ì§€ íŒŒì¼ì´ í•„ìš”í•œë° \`jest.config.js\`ì™€ \`jest.setup.js\`ë‹¤.

#### jest.setup.js

```
import '@testing-library/jest-dom'
```

#### jest.config.js

```
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['./jest.setup.js'],
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],
  moduleDirectories: ['src'],
  testRegex: '(/__(tests|specs)__/.*|(\\.|/)(test|spec))\\.([tj]sx?)$',
  transform: {
    '^.+\\.jsx?$': 'babel-jest',
    '^.+\\.tsx?$': 'ts-jest',
  },
  moduleNameMapper: {
    '\\.(jpg|ico|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':
      'identity-obj-proxy',
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
  },
  globals: {
    __PATH_PREFIX__: '',
    'ts-jest': {
      diagnostics: false,
      tsconfig: 'tsconfig.jest.json',
      babelConfig: true,
    },
  },
}
```

jestë¥¼ í™œìš©í•  tsconfigë¥¼ ë”°ë¡œ ë¶„ë¦¬í•˜ì˜€ë‹¤. (tsconfig.jsonìœ¼ë¡œ í•œ ë²ˆì— ì²˜ë¦¬í•´ë„ ë¬´ë°©í•˜ë‹¤.)

ì´ ë‘ê°€ì§€ íŒŒì¼ì„ í†µí•´ test ëª…ë ¹ì— ëŒ€í•œ ì„¤ì •ê°’ì„ ì œê³µí•œë‹¤.

#### í…ŒìŠ¤íŠ¸

ì´ì œ ì„ì˜ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬í˜„í•˜ê³  testë¥¼ ì§„í–‰í•´ë³´ì

```
// src/Accordion/index.spec.tsx

import React, { useState } from 'react'
import { render, screen } from '@testing-library/react'
import { renderHook, act } from '@testing-library/react-hooks'
import userEvent from '@testing-library/user-event'
import '@testing-library/jest-dom'

import Accordion from './index'

describe('Accordion', () => {
  test('ì œëª© propì¸ titleì— "ìœ ì˜ì‚¬í•­"ì„ ì…ë ¥í•˜ë©´ ì œëª©ì— "ìœ ì˜ì‚¬í•­"ì´ ì¶œë ¥ëœë‹¤.', () => {
    render(<Accordion title="ìœ ì˜ì‚¬í•­" />)

    const titleElement = screen.getByText('ìœ ì˜ì‚¬í•­')
    expect(titleElement).toHaveTextContent('ìœ ì˜ì‚¬í•­')
  })

  test('ìµœì´ˆ ìƒíƒœì˜ ì•„ì½”ë””ì–¸ì„ í´ë¦­í•˜ë©´ ì…ë ¥í•œ ì•„ì½”ë””ì–¸ ìƒì„¸ ë‚´ìš©ì¸ "ì¡°ì‹¬í•˜ì„¸ìš”"ê°€ ë³´ì—¬ì§„ë‹¤.', () => {
    render(<Accordion>ì¡°ì‹¬í•˜ì„¸ìš”</Accordion>)

    const contentElement = screen.getByRole('button')
    userEvent.click(contentElement)

    const detailElement = screen.getByText('ì¡°ì‹¬í•˜ì„¸ìš”')
    expect(detailElement).toHaveTextContent('ì¡°ì‹¬í•˜ì„¸ìš”')
  })

  test('ì•„ì½”ë””ì–¸ì˜ ì´ë²¤íŠ¸ë¥¼ ì™¸ë¶€ì—ì„œ ë°›ì•„ì™”ì„ ë•Œ ìƒì„¸ ë‚´ìš©ì¸ "ì¡°ì‹¬í•˜ì„¸ìš”"ê°€ ë³´ì—¬ì§„ë‹¤.', () => {
    const { result } = renderHook((value) => useState(!!value), {
      initialProps: false,
    })

    const handleIsOpenToggle = () => {
      result.current[1]((state) => !state)
    }

    const { rerender } = render(
      <Accordion isOpen={result.current[0]} onToggle={handleIsOpenToggle}>
        ì¡°ì‹¬í•˜ì„¸ìš”
      </Accordion>,
    )

    expect(result.current[0]).toBe(false)

    act(() => {
      handleIsOpenToggle()
    })

    rerender(
      <Accordion isOpen={result.current[0]} onToggle={handleIsOpenToggle}>
        ì¡°ì‹¬í•˜ì„¸ìš”
      </Accordion>,
    )

    expect(result.current[0]).toBe(true)

    const detailElement = screen.getByText('ì¡°ì‹¬í•˜ì„¸ìš”')
    expect(detailElement).toHaveTextContent('ì¡°ì‹¬í•˜ì„¸ìš”')
  })
})
```

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ì

```
yarn jest
```

@@ í…ŒìŠ¤íŠ¸ ì§¤ @@

@@ í¸ì•ˆ ì§¤ @@

ë“œë””ì–´ ê¸¸ê³  ê¸´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì—¬ì •ì´ ëë‚¬ë‹¤. (í…ŒìŠ¤íŠ¸ í•˜ê¸°ë„ ì „ì— ì§€ì³ë²„ë¦¼.. ğŸ˜­)

ì´ì œ ë§ˆì§€ë§‰ ë‹¨ê³„ì¸ **Storybook**ì„ ì¶”ê°€í•´ë³´ì
