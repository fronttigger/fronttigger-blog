---
title: MSWë¡œ API ëª¨í‚¹í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸í•˜ê¸° #required
tags:
  - MSW
  - react
  - react-testing-library
  - moking
  - test
published: true # required
date: '2022. 7. 17' # required
description: 'ìš°í™©ì²­ì‹¬ì›' # required
thumbnailImg: '/thumbnail/2022/04/react/react-hook.png' # required
---

import Image from './src/components/image'

## í…ŒìŠ¤íŠ¸ ì½”ë“œ ë„ì… ì°

í”„ë¡ íŠ¸ì—”ë“œëŠ” íŠ¹ì„±ìƒ ì‚¬ìš©ìì™€ì˜ ì§ì ‘ì ì¸ ìƒí˜¸ì‘ìš©ì„ í†µí•´ ì¦‰ê°ì ì¸ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

ì´ëŠ” ì¥ì ì´ì ë‹¨ì ì´ ë  ìˆ˜ ìˆëŠ”ë°, ê·¸ë§Œí¼ ì‚¬ì´í´ì„ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•´ì•¼í•˜ëŠ” ìƒí™©ì´ êµ‰ì¥íˆ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•œë‹¤. ğŸ˜…

ìµœê·¼ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ë‹¤ë³´ë‹ˆ ìƒˆë¡œìš´ ì‹ ê·œ ê¸°ëŠ¥ ê°œë°œë„ ë¬¼ë¡  ìˆì—ˆì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ì—…ë¬´ëŠ” ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ìœ ì§€ë³´ìˆ˜ë¥¼ í•˜ëŠ” ê²½ìš°ê°€ êµ‰ì¥íˆ ë§ì•˜ë‹¤.

ì˜ˆë¥¼ë“¤ë©´ ê¸°ì¡´ ë°”í…€ì‹œíŠ¸ ë‚´ì— ë²„íŠ¼ì´ ìƒˆë¡œ ì¶”ê°€ëœë‹¤ë˜ì§€, ë¬´ì–¸ê°€ì˜ ìƒíƒœê°’ì´ ì¶”ê°€ê°€ ëœë‹¤ë˜ì§€, í˜¹ì€ ê²°ì œ í”„ë¡œì„¸ìŠ¤ì˜ ë³€ê²½ ë“± ì—¬ëŸ¬ ê¸°ëŠ¥ì—ì„œ ì¶”ê°€ì ì¸ ìš”êµ¬ì‚¬í•­ì´ ìŸì•„ì¡Œë‹¤.

ì´ë ‡ê²Œ ê°œë°œí•˜ë‹¤ ë³´ë‹ˆ ìœ„ì—ì„œ ì˜ˆì‹œë¥¼ ë“¤ì—ˆë˜ ê²°ì œì™€ ê°™ì€ ë¯¼ê°í•œ ë„ë©”ì¸, í˜¹ì€ APIê°€ ë³€ê²½ë˜ì–´ì•¼í•˜ëŠ” ê±´ë“¤ì´ ì¢…ì¢… ë°œìƒí–ˆë‹¤. ğŸ˜–

ê·¸ë˜ì„œ ì´ë¥¼ ê°œë°œí•˜ê¸° ìœ„í•´ ê±´ë“œë¦¬ë‹¤ë³´ë©´ êµ‰ì¥íˆ ë¶ˆì•ˆí•˜ë‹¤.

> í˜¹ì‹œ ì´ ì½”ë“œ ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ëŒì•„ê°€ì§€ ì•Šìœ¼ë©´ ì–´ë–¡í•˜ì§€..?  
> APIê°€ ë³€ê²½ë˜ì„œ ì–´ë””ì„ ê°€ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ í„°ì§€ë©´ ì–´ë–¡í•˜ì§€..?  
> ì´ ì½”ë“œëŠ” íˆìŠ¤í† ë¦¬ë¥¼ ëª¨ë¥´ëŠ”ë°..? ì—‰ì—‰ ã… ã… ã… ã… 

ìœ„ì˜ ì˜ˆì‹œì™€ ê°™ì´ ê¸°ì¡´ì— ì •ìƒì ìœ¼ë¡œ ëŒì•„ê°”ë˜ ê¸°ëŠ¥ì´ ëŒì•„ê°€ì§€ ì•ŠëŠ” ê²ƒì— ëŒ€í•œ ë¶ˆê¸¸í•œ ê°ì •ë“¤ì´ ì—„ìŠµí–ˆë‹¤.

ì‚¬ì‹¤ ìœ„ì—ì„œ ì‘ì„±í•œ ì˜ˆì‹œ ë¿ë§Œ ì•„ë‹ˆë¼ ìˆ˜ì •í•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ì´ëŸ° ìƒê°ì´ ë“¤ê²Œ ëœë‹¤.

ê·¸ë˜ì„œ ì´ë¥¼ íƒ€íŒŒí•˜ê¸° ìœ„í•´ ê³¼ê°íˆ ë„ì…í•˜ìê³  ê²°ë¡ ë‚´ë¦° ê²ƒì´ ë°”ë¡œ **í…ŒìŠ¤íŠ¸**ë‹¤. (ë¬¼ë¡  100%ë¥¼ í•´ê²°í•´ì£¼ì§„ ì•Šê² ì§€ë§Œ..)

## MSW ë„ì… ì´ìœ 

í”„ë¡ íŠ¸ì—”ë“œì˜ í…ŒìŠ¤íŠ¸ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒ ìì²´ë„ ì–´ë µì§€ë§Œ ì—¬ëŸ¬ê°€ì§€ ì œì•½ì‚¬í•­ì´ ì¡´ì¬í–ˆëŠ”ë°, ê·¸ ì¤‘ì— í•˜ë‚˜ê°€ ë°”ë¡œ \`API\`ì˜€ë‹¤.

í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ **ë°ì´í„°** í˜¹ì€ ê°œë°œëœ **ìŠ¤í‚¤ë§ˆ**ê°€ ë™ì¼í•˜ì§€ ì•Šì€ ìƒí™©ì´ ìˆì—ˆìœ¼ë©°, ì•„ì§ ë°±ì—”ë“œ ê°œë°œì´ ì™„ì„±ë˜ì§€ ì•ŠëŠ” ìƒíƒœê±°ë‚˜ ì™„ì„± ë˜ì—ˆì–´ë„ ë¬¸ì œë¡œ ì¸í•´ ë‹¤ì‹œ ê°œë°œì„ í•´ì•¼í•˜ëŠ” ê²½ìš°ë“¤ì´ êµ‰ì¥íˆ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí–ˆë‹¤. ì´ëŸ° ê³ ë¯¼ë“¤ì„ ëœê¸° ìœ„í•´ ì—¬ëŸ¬ê°€ì§€ë¥¼ ê³ ë¯¼í•˜ë˜ ì™€ì¤‘ ì•Œì•„ë‚¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ [MSW](https://mswjs.io/)ë¥¼ ì•Œê²Œë˜ì—ˆë‹¤.

MSWëŠ” í•œ ë²ˆì˜ ëª¨í‚¹ ì²˜ë¦¬ë¥¼ í†µí•´ **ë¸Œë¼ìš°ì €**ì™€ **ë…¸ë“œ** í™˜ê²½ì„ ëŒ€ì‘í•  ìˆ˜ ìˆë‹¤.

[##_Image|kage@cXRYTu/btrG4URoJhB/bMaTr3GF58Pjyv8AOJyPK0/img.png|CDM|1.3|{"originWidth":1252,"originHeight":774,"style":"alignCenter","width":564,"height":349}_##]

ë¸Œë¼ìš°ì €ì—ì„œëŠ” \`Service Worker\`ë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ìš”ì²­í•˜ëŠ” requestë¥¼ ê°€ë¡œì±„ mokingí•œ APIë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.

ë…¸ë“œ í™˜ê²½ì—ì„œëŠ” \`node-request-interceptor\` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ http, https, XMLHttpRequest ëª¨ë“ˆì„ í™•ì¥í•´ì„œ ì²˜ë¦¬í•œë‹¤.

ì´ë ‡ê²Œ í¸ë¦¬í•˜ê²Œ APIë¥¼ ëª¨í‚¹ í•  ìˆ˜ ìˆëŠ” ì ì—ì„œ êµ‰ì¥íˆ ë§¤ë ¥ì ìœ¼ë¡œ ë‹¤ê°€ì™”ë‹¤.

ê·¸ë˜ì„œ ì‹œì‘ì€ ê°„ë‹¨í•˜ê³  ë‹¨ìˆœí•œ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ë¡œ í•´ì„œ MSWë¥¼ í™œìš©í•´ í…ŒìŠ¤íŠ¸ í•´ë³´ê¸°ë¡œ í–ˆë‹¤.

## MSW ì„¤ì •

ë¨¼ì € MSWë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ [íŠœí† ë¦¬ì–¼](https://mswjs.io/docs/getting-started/install)ì„ ì°¸ê³ í–ˆë‹¤.

### ì„¤ì¹˜

```
npm install msw --save-dev
# or
yarn add msw --dev
```

#### ëª¨í‚¹ í•¸ë“¤ëŸ¬ êµ¬í˜„

```
// src/components/mocks/handlers.ts
import { rest } from 'msw'

const review = {
  rating: 4.3,
  commentCount: 200,
}

const getReview = (isError?: boolean) => {
  return rest.get('/review', (_, res, ctx) => {
    if (isError) {
      return res(ctx.status(500))
    }

    return res(ctx.status(200), ctx.json(review))
  })
}

const reviewHandlers = [getReview()]

export default reviewHandlers
```

í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  íŠ¹ì • ë„ë©”ì¸ì— í•´ë‹¹ë˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜í–ˆë‹¤.

ì—”ë“œí¬ì¸íŠ¸ëŠ” \`/review\`, responseëŠ” review ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ê·¸ë¦¬ê³  ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ ìƒíƒœ 500ì„ ë°˜í™˜í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

### í•¸ë“¤ëŸ¬ ëª¨ë“ˆ ê´€ë¦¬

```
// src/mocks/handlers.js
import reviewHandlers from '../components/Evaluation/mocks/handlers'

export const handlers = [...Object.values(reviewHandlers)]
```

ë§ì•„ì§ˆ í•¸ë“¤ëŸ¬ë¥¼ ëŒ€ë¹„í•´ í†µí•© í•¸ë“¤ëŸ¬ ëª¨ë“ˆì„ ìƒì„±í–ˆë‹¤.

ì´ì œ ì´ í†µí•©í•œ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ì„œ ë¸Œë¼ìš°ì €, ë…¸ë“œ ë‘ê°€ì§€ í™˜ê²½ì— ëª¨í‚¹ì„ ì§„í–‰í•˜ë©´ ëœë‹¤.

### ë¸Œë¼ìš°ì €

ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ë“±ë¡í•˜ì—¬ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ë„ë¡ ì²˜ë¦¬í•´ì¤˜ì•¼í•œë‹¤.

#### ì„œë¹„ìŠ¤ ì›Œì»¤ ëª¨ë“ˆ ìƒì„±

```
npx msw init public/ --save
```

ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ public ë””ë ‰í† ë¦¬ì— ì„œë¹„ìŠ¤ ì›Œì»¤ ëª¨ë“ˆì„ ìƒì„±í•œë‹¤.

#### í•¸ë“¤ëŸ¬ ë“±ë¡

```
// src/mocks/browser.js
import { setupWorker } from 'msw'
import { handlers } from './handlers'

export const worker = setupWorker(...handlers)
```

ì´ì „ì— ë§Œë“¤ì–´ ë‘ì—ˆë˜ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•œë‹¤.

```
// src/index.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'

if (process.env.NODE_ENV === 'development') {
  const { worker } = require('./mocks/browser')
  worker.start()
}

const root = ReactDOM.createRoot(document.getElementById('root') as HTMLElement)
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

ê°œë°œ í™˜ê²½ì¼ ë•Œ ì›Œì»¤ë¥¼ ì‹¤í–‰í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ì¤€ë¹„ ë!

### ë…¸ë“œ

ë¸Œë¼ìš°ì €ì™€ ë§ˆì°¬ê°€ì§€ë¡œ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡ì‹œí‚¨ë‹¤.

#### í•¸ë“¤ëŸ¬ ë“±ë¡

```
// src/mocks/server.js
import { setupServer } from 'msw/node'
import { handlers } from './handlers'

export const server = setupServer(...handlers)
```

```
// src/setupTests.js
import { server } from './mocks/server.js'

beforeAll(() => server.listen()) // ì„œë²„ ì„¤ì •

afterEach(() => server.resetHandlers()) // ê°ê° í…ŒìŠ¤íŠ¸ ìš”ì²­ ë§ˆë‹¤ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”

afterAll(() => server.close()) // í…ŒìŠ¤íŠ¸ê°€ ëë‚œ í›„ ì¢…ë£Œ
```

#### Jest ì„¤ì •

ë§Œì•½ CRA í™˜ê²½ì´ ì•„ë‹ˆë¼ë©´ Jest ì„¤ì •ì´ ì¶”ê°€ë¡œ í•„ìš”í•˜ë‹¤.

```
// jest.setup.js
module.exports = {
  setupFilesAfterEnv: ['./jest.setup.js'],
}
```

ì ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨ë“  ì¤€ë¹„ê°€ ëë‚¬ë‹¤.

ì•„ê¹Œ ëª¨í‚¹í•œ APIë¥¼ ì‚¬ìš©í•´ë³´ê¸° ìœ„í•´ ê°„ë‹¨í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì˜ˆì‹œë¡œ í…ŒìŠ¤íŒ… í•´ë³´ì! ğŸ‘¨ğŸ»â€ğŸ’»

## ë³„ì  ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

í‰ì ì„ í†µí•´ ì´ 5ê°œì˜ ë³„ë¡œ í‘œì‹œí•´ì£¼ë©° ë™ì‹œì— í›„ê¸°ì˜ ê°¯ìˆ˜ë¥¼ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤. (ìì„¸í•œ ìŠ¤íƒ€ì¼ê³¼ êµ¬í˜„ì²´ëŠ” ìƒëµí•œë‹¤.)

```
function StarReview({
  rating = 0.0,
  commentCount = 0,
}: StarProps): JSX.Element {
  return (
    <Container>
      <StarGroup rating={rating} />
      <StarAverage>{rating.toFixed(1)}</StarAverage>
      <StarReviewContainer>
        <StarReviewRatingText>í›„ê¸°</StarReviewRatingText>
        <StarReviewCount>{commentCount}</StarReviewCount>
      </StarReviewContainer>
    </Container>
  )
}

export default StarReview
```

ì´ ì»´í¬ë„ŒíŠ¸ì˜ propsëŠ” **rating**ì´ë¼ëŠ” í‰ì ê³¼, **commentCount**ì˜ í›„ê¸° ê°¯ìˆ˜ë¥¼ ë°›ì•„ì„œ ê·¸ë ¤ì¤€ë‹¤.

ì¦‰, ì´ì „ì— ë§Œë“¤ì—ˆë˜ \`/review\` APIë¥¼ í†µí•´ ëª¨í‚¹í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒì—ì„œ ì´ìƒì´ ì—†ëŠ”ì§€, ê·¸ë¦¬ê³  ê·¸ ë°ì´í„°ë¥¼ ì‹¤ì œ í™”ë©´ì—ì„œ ì˜ ê·¸ë ¤ì§€ê³  ìˆëŠ”ì§€ í™•ì¸ì„ í•˜ë©´ ë  ê²ƒì´ë‹¤.
